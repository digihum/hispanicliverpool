<html>
<head>

  <style>

/***** Page Curl CSS3 - IE9+ http://nicolasgallagher.com/css-drop-shadows-without-images/ *****/
/* Shared styles */
.drop-shadow {
  position: relative;
  display: block;
  padding: 1em;
  margin-bottom: 1em;
  background: #fff;
  -webkit-box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3), 0 0 40px rgba(0, 0, 0, 0.1) inset;
  -moz-box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3), 0 0 40px rgba(0, 0, 0, 0.1) inset;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3), 0 0 40px rgba(0, 0, 0, 0.1) inset;
}
.drop-shadow:before, .drop-shadow:after {
  content: "";
  position: absolute;
  z-index: -2;
}
/* Lifted corners */

.lifted:before, .lifted:after {
  bottom: 15px;
  left: 10px;
  width: 50%;
  height: 20%;
  max-width: 300px;
  -webkit-box-shadow: 0 15px 10px rgba(0, 0, 0, 0.7);
  -moz-box-shadow: 0 15px 10px rgba(0, 0, 0, 0.7);
  box-shadow: 0 15px 10px rgba(0, 0, 0, 0.7);
  -webkit-transform: rotate(-3deg);
  -moz-transform: rotate(-3deg);
  -ms-transform: rotate(-3deg);
  -o-transform: rotate(-3deg);
  transform: rotate(-3deg);
}
.lifted:after {
  right: 10px;
  left: auto;
  -webkit-transform: rotate(3deg);
  -moz-transform: rotate(3deg);
  -ms-transform: rotate(3deg);
  -o-transform: rotate(3deg);
  transform: rotate(3deg);
}
/* Curved shadows */
.curved:before {
  top: 10px;
  bottom: 10px;
  left: 0;
  right: 50%;
  -webkit-box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
  -moz-box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
  -moz-border-radius: 0.1px;
  border-radius: 0.1px;
}

.page{
position: relative;
z-index: 1 !important;
}

/* sort table */

table.table thead .sorting,
table.table thead .sorting_asc,
table.table thead .sorting_desc,
table.table thead .sorting_asc_disabled,
table.table thead .sorting_desc_disabled {
    cursor: pointer;
    *cursor: hand;
}
 
table.table thead .sorting { background: url('/static_war/render/images/sortabletables/none.gif') no-repeat center right; }
table.table thead .sorting_asc { background: url('/static_war/render/images/sortabletables/up.gif') no-repeat center right; }
table.table thead .sorting_desc { background: url('/static_war/render/images/sortabletables/down.gif') no-repeat center right; }

#main-content ul
{ 
  padding-left: 0; margin: 0;
  list-style: disc inside;
}

</style>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.js"></script>
  <link rel="stylesheet" href="bootstrap.min.css?[build-timestamp]" />
  <link rel="stylesheet" href="bootstrap-theme.min.css?[build-timestamp]" />
  <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <script src="bootstrap.min.js?[build-timestamp]"></script>
  <script language="JavaScript" type="text/javascript" src="jquery.datatables.min.js"></script>
  <script language="JavaScript" type="text/javascript" src="datatables_bootstrap_3.js"></script>
  <script language="JavaScript" type="text/javascript" src="underscore.js"></script>
  <script language="JavaScript" type="text/javascript" src="backbone.js"></script>
  <style>
    .full-width {margin-left: -16px !important; margin-right: -16px !important;}
    </style>
</head>
<body>
<div class="full-width">
  <div class="container">
    <div id="breadcrumb"></div>

    <script type="text/template" id="breadcrumb-template">
  <ul class="breadcrumb">
      <li><a href="#">Home</a> <span class="divider">/</span></li>
        <% _.each(breadcrumbs, function(crumb) { %>
      <li><a href="#<%- crumb.url %>"><%- crumb.title %></a> <span class="divider">/</span></li>
        <% }); %></ul>
</script>

    <hr />
    <div class="page is-stackable"></div>

  </div>
</div>

  <script type="text/template" id="view-person-template">
<div class="row">
  <div class="col-sm-12">
    <h3><i class="icon-user"></i> Individual</h3>
    <div class="lifted card drop-shadow">
      <div class="row">
        <div class="col-sm-6">
          <p>Name: <%- person.get('forenames') %> <%- person.get('surname') %></p>
<p>Date: <%- person.get('yearonrecord') %> <%- person.get('dateonrecord') %></p>
<p>Sex: <%- person.get('sex') %></p>
        </div>
        <div class="col-sm-6">
          <p>Citizenship: <%- person.get('citizenship') %></p>
          <p>Country: <%- person.get('country') %></p>
          <p>Place: <%- person.get('place') %></p>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
<div class="col-sm-12">
<h3 class="muted"><i class="icon-list-alt"></i> Records</h3>
<div class="lifted card drop-shadow">
<p class="muted">Here you'll be able to see biographical records, occupations etc, in chronological order.
</p>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<h3 class="muted"><i class="icon-resize-horizontal"></i> Relations</h3>
<div class="lifted card drop-shadow">
<p class="muted">Here you'll be able to see the relations for this individual</p>
</div>
</div>
</div>
</script>

  <script type="text/template" id="person-list-template">
  <button class="btn btn-primary"><i class="fa fa-search"></i> People Search</button>
    <hr />
    <table class="table table-striped table-bordered" id="persons-table">
      <thead>
        <tr>
          <th>Forename(s)</th><th>Surname</th><th>Sex</th><th>&nbsp;</th>
        </tr>
      </thead>
      <tbody>
        <% _.each(persons, function(person) { %>
          <tr>
            <td><a href="#/view/<%= person.id %>"><%- person.get('forenames') %></a></td>
            <td><a href="#/view/<%= person.id %>"><%- person.get('surname') %></a></td>
            <td><%- person.get('sex') %></td>
            <td><button class="btn" href="#/edit/<%= person.id %>">Edit</button></td>
          </tr>
        <% }); %></tbody>
    </table>
  </script>

  <script type="text/template" id="search-form-template">
  <h1><i class="fa fa-search"></i>People Search</h1>
<form id="search-form" class="form-horizontal" role="form">
  <div class="form-group">
    <label  class="col-sm-2 control-label col-xs-3" for="surnames">Suname(s)</label>
    <div class="col-sm-3 col-xs-9">
    <input type="email" class="form-control " id="surnames" name="surnames"  placeholder="accepts multiple names"></div>
    <label class="col-sm-2 col-xs-3 control-label" for="fornames">Forename(s)</label>
    <div class="col-sm-3 col-xs-9">
    <input type="text" class="form-control" id="forenames" name="forenames"  placeholder="accepts multiple names"></div>

  </div>

  <div class="form-group" >    <label class="col-sm-2 col-xs-3 control-label" for="gender" >Gender(s)</label>
    <div class="btn-group col-sm-10" data-toggle="buttons">

    <label class="btn btn-default" >
      <input type="checkbox" name="gender" value="m"/>Male
    </label>
    <label class="  btn btn-default">
      <input type="checkbox" name="gender" value="f"/>Female
    </label>
    <label class="  btn btn-default">
      <input type="checkbox" name="gender" value="u"/>Unknown
      </label></div>
  </div>
    <hr/>  <div id="search-birth" class="panel panel-default">
  <div class="panel-heading"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#search-birth" href="#search-birth-content">Include birth criteria</a></h4></div>
    <div id="search-birth-content" class="panel-collapse collapse ">
      <div class="panel-body">

  <div class="form-group">
    <label class="col-sm-2 control-label col-xs-3" for="birth-range">Year</label>
    <div class="col-sm-6">
    <div class="btn-group btn-group-justified" data-toggle="buttons">
        <label class="btn btn-default" id="birth-range-0">
      <input type="radio" name="birth-range" value="0"/>Precice
    </label>
    <label class="  btn btn-default" id="birth-range-1">
      <input type="radio" name="birth-range" value="1"/>Before
    </label>
    <label class="  btn btn-default" id="birth-range-2">
      <input type="radio" name="birth-range" value="2"/>After
      </label>
          <label class="  btn btn-default" id="birth-range-3">
      <input type="radio" name="birth-range" value="3"/>Between
      </label>
    </div>
    </div>
    </div>
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10 col-xs-12 form-inline">
        <input type="text" class="form-control col-xs-5" id="birth-start" name="birth-start"  placeholder="YYYY" style="display:none" >

      <label class="control-label" for="birth-end" id="birth-and" style="display:none">and</label>

        <input type="text" class="form-control " id="birth-end" name="birth-end" placeholder="YYYY" style="display:none">
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label col-xs-3" for="birth-country">Country</label>
      <div class="btn-group col-sm-6 col-xs-9" >
        <select class="form-control" name="birth-country">
          <option>country</option>
          <option>country</option>
          <option>country</option>
          <option>country</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label col-xs-3" for="birth-place" >Place</label>
      <div class="btn-group col-sm-6 col-xs-9" >
        <select class="form-control" name="birth-place">
          <option>place</option>
          <option>place</option>
          <option>place</option>
          <option>place</option>
        </select>
      </div>
    </div>
    </div>
    </div>
    </div>

  <div id="search-death" class="panel panel-default">
  <div class="panel-heading"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#search-death" href="#search-death-content">Include death criteria</a></h4></div>
    <div id="search-death-content" class="panel-collapse collapse">
      <div class="panel-body">
  <div class="form-group watch">
    <label class="col-sm-2 control-label col-xs-3" for="death-range">Year</label>
    <div class="col-sm-6 col-xs-12">
    <div class="btn-group btn-group-justified " data-toggle="buttons">
        <label class="btn btn-default" id="death-range-0">
      <input type="radio" name="death-range" value="0"/>Precice
    </label>
    <label class="  btn btn-default"  id="death-range-1">
      <input type="radio" name="death-range" value="1"/>Before
    </label>
    <label class="  btn btn-default" id="death-range-2">
      <input type="radio" name="death-range" value="2"/>After
      </label>
          <label class="  btn btn-default" id="death-range-3">
      <input type="radio" name="death-range" value="3"/>Between
      </label>
    </div>
    </div>
    </div>
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10 form-inline">
        <input type="text" class="form-control" id="death-start" name="death-start" placeholder="YYYY" style="display:none">

      <label class="control-label" for="death-end" id="death-and" style="display:none">and</label>

        <input type="text" class="form-control" id="death-end" name="death-end" placeholder="YYYY" style="display:none">
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label col-xs-3" for="death-country">Country</label>
      <div class="col-sm-6 col-xs-9" >
        <select class="form-control" name="death-country">
          <option>country</option>
          <option>country</option>
          <option>country</option>
          <option>country</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label class="col-sm-2 control-label col-xs-3" for="death-place" >Place</label>
      <div class="col-sm-6 col-xs-9" >
        <select class="form-control" name="death-place">
          <option>place</option>
          <option>place</option>
          <option>place</option>
          <option>place</option>
        </select>
      </div>
    </div>
    </div>

    </div></div>
      <div class="form-group form-options">
    <div class="col-sm-offset-2 col-sm-10">
  <button type="submit" class="btn btn-primary"><i class="fa fa-search"></i>  Search</button>
  <button type="reset" class="btn btn-danger" data-dismiss="modal" value="reset">Clear</button>

  </div>
</form>
</script>

  <script type="text/template" id="edit-person-template">
    <form class="edit-user-form">
      <legend><%= user ? 'Edit' : 'New' %>User</legend>
        <label >First Name</label>
        <input name="firstname" type="text" value="<%= user ? user.get('firstname') : '' %>">
        <label>Last Name</label>
        <input name="lastname" type="text" value="<%= user ? user.get('lastname') : '' %>">
        <label>Age</label>
        <input name="age" type="text" value="<%= user ? user.get('age') : '' %>">
        <hr />
       <button type="submit" class="btn"><%= user ? 'Update' : 'Create' %></button>
       <% if(user) { %>
        <input type="hidden" name="id" value="<%= user.id %>" />
       <button data-user-id="<%= user.id %>" class="btn btn-danger delete">Delete</button>
       <% }; %></form>
  </script>

  <script>

(function($){





    var importPeople = [{"id":"1","surname":"Abad","forenames":"Mariano","gender":"m"},{"id":"2","surname":"Abaitua","forenames":"Juan","gender":"m"},{"id":"3","surname":"Abaitua","forenames":"Eulalia","gender":"f"},{"id":"4","surname":"Abaitua","forenames":"Felipe","gender":"m"},{"id":"5","surname":"Abaitua","forenames":"Ignacio","gender":"m"},{"id":"6","surname":"Abaitua","forenames":"Luis","gender":"m"},{"id":"7","surname":"Abaitua","forenames":"Rosario de","gender":"f"},{"id":"8","surname":"Abaitua","forenames":"Juan Bautista de","gender":"m"},{"id":"9","surname":"Abal","forenames":"Antonio","gender":"m"},{"id":"10","surname":"Rodriguez","forenames":"Maria Luisa","gender":"f"},{"id":"11","surname":"Alvarez","forenames":"Ana Maria","gender":"f"},{"id":"12","surname":"Abascal","forenames":"Eusebio","gender":"m"},{"id":"13","surname":"Abella","forenames":"Martin","gender":"m"},{"id":"14","surname":"Aberto","forenames":"Pedro","gender":"m"},{"id":"15","surname":"Ibieta","forenames":"Dionisia","gender":"f"},{"id":"16","surname":"Aboytis","forenames":"Guillermo","gender":"m"},{"id":"17","surname":"Aboytis","forenames":"Jose","gender":"m"},{"id":"18","surname":"Achaval","forenames":"Gloria","gender":"f"},{"id":"19","surname":"Adaro","forenames":"Maria","gender":"f"},{"id":"20","surname":"Adaro","forenames":"Manuela","gender":"f"},{"id":"21","surname":"Adalea","forenames":"Anastasia","gender":"f"},{"id":"22","surname":"Adalea","forenames":"Francisca","gender":"f"},{"id":"23","surname":"Adalea","forenames":"John","gender":"m"},{"id":"24","surname":"Willet-Vicary","forenames":"Penelope","gender":"f"},{"id":"25","surname":"Adamson","forenames":"James F","gender":"m"},{"id":"26","surname":"Adamson","forenames":"Josepha N","gender":"f"},{"id":"27","surname":"Aldamiz","forenames":"Esteban","gender":"m"},{"id":"28","surname":"Adao","forenames":"Guileborne","gender":"m"},{"id":"29","surname":"Agada","forenames":"Victoria","gender":"f"},{"id":"30","surname":"Ugalde","forenames":"Maria","gender":"f"},{"id":"31","surname":"Ugalde","forenames":"Michael","gender":"m"},{"id":"32","surname":"Agretegio","forenames":"Birina","gender":"f"},{"id":"33","surname":"Agretegio","forenames":"Susie","gender":"f"},{"id":"34","surname":"Aguilar Pelaez","forenames":"Emma de","gender":"f"},{"id":"35","surname":"Aguilar Pelaez","forenames":"Victor","gender":"m"},{"id":"36","surname":"Aguirre","forenames":"Leopoldo","gender":"m"},{"id":"37","surname":"Aguirre","forenames":"Isidora","gender":"f"},{"id":"38","surname":"Agustin","forenames":"Jose","gender":"m"},{"id":"39","surname":"Alanarrie","forenames":"Christof","gender":"m"},{"id":"40","surname":"Albistur","forenames":"Alfredo","gender":"m"},{"id":"41","surname":"Albizure","forenames":"Francisco Antonio","gender":"m"}];

    function htmlEncode(value){
      return $('<div/>').text(value).html();
    }
    $.fn.serializeObject = function() {
      var o = {};
      var a = this.serializeArray();
      $.each(a, function() {
          if (o[this.name] !== undefined) {
              if (!o[this.name].push) {
                  o[this.name] = [o[this.name]];
              }
              o[this.name].push(this.value || '');
          } else {
              o[this.name] = this.value || '';
          }
      });
      return o;
    };

    $.ajaxPrefilter( function( options, originalOptions, jqXHR ) {
      options.url = 'http://researchdb.warwick.ac.uk/liverpool/api'  + options.url;
    });

    var Persons = Backbone.Collection.extend({
      url: '/people'
    });


    var Person = Backbone.Model.extend({
      urlRoot: '/record/id/'
    });    

    var PersonListView = Backbone.View.extend({
      el: '.page',
      render: function () {
        var that = this;

     var persons = new Persons();

      persons.reset(importPeople);
    _.each(importPeople, function(person){
  var newPerson = new Person(person)
  persons.add(newPerson); 
     });

        console.log(persons);

            var template = _.template($('#person-list-template').html(), {persons: persons.models});
            that.$el.html(template);
   
              var template = _.template($('#breadcrumb-template').html(), {breadcrumbs: []});
              $('#breadcrumb').html(template);
  $('#persons-table').dataTable( {
    "sDom": "<'row'<'col-sm-6'l><'col-sm-6'f>r>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
    "sPaginationType": "bootstrap",
    "bFilter": false,
      "aoColumnDefs": [
            { "bSortable": false, "aTargets": [3] } //disable sortables on these columns (starts at 0)
        ] ,
    "oLanguage": {
      "sLengthMenu": "_MENU_ people per page"
    }
  } );
      }
    });

    var SearchFormView = Backbone.View.extend({
      el: '.page',
      render: function(options){
              var template = _.template($('#breadcrumb-template').html(), {breadcrumbs: [{title:"Search",
                url: "/search"}]});
              $('#breadcrumb').html(template);
            var template = _.template($('#search-form-template').html(), {});
      this.$el.html(template);
      },
      events: {
        "click div[id^=search-] label.btn":"visualDateUpdate",
        "change input[id$=-start], input[id$=-end]": "valueDateUpdate",
        "submit #search-form": "searchResults"
      },
      searchResults: function(){
        alert("not quite ready yet");
        return false;
      },
      visualDateUpdate: function(event){
        var optionHit = $(event.currentTarget)[0].firstElementChild;
        var set = $(optionHit)[0].name.split("-")[0];
        var value = parseInt($(optionHit)[0].value);
        switch(value){
          case 0:
            $("#" + set + "-end, #" + set + "-and").hide();
            $("#" + set + "-start").show();
            break;
          case 1:
            $("#" + set + "-start, #" + set + "-and").hide();
            $("#" + set + "-end").show();
            break;
          case 2:
            $("#" + set + "-end, #" + set + "-and").hide();
            $("#" + set + "-start").show();
            break;  
          case 3:
            $("#" + set + "-end, #" + set + "-and, #" + set + "-start").show();
            break;       
          default:
            break;
        }
        this.valueDateUpdate(event);
        console.log("visual");
      },
      valueDateUpdate: function(event){
        console.log(event.type);
        var set = event.currentTarget.id.split("-")[0];
        if(event.type == "click"){
          var optionSelected = parseInt(event.currentTarget.id.split('-')[2]);          
        }
        if(event.type == "change"){
          var optionSelected = parseInt($("input[name=" + set + "-range]:checked").val()); 
        };
        switch(optionSelected){
          case 0: //precice
            if($("#"+set+"-start").val() == "0000"){
              $("#"+set+"-start").val("");
            }
            $("#"+set+"-end").val($("#"+set+"-start").val());
            break;
          case 1: //before
            $("#"+set+"-start").val("0000");
            if($("#"+set+"-end").val() == "9999"){
              $("#"+set+"-end").val("");
            }
            break;
          case 2: //after
            $("#"+set+"-end").val("9999")
            if($("#"+set+"-start").val() == "0000"){
              $("#"+set+"-start").val("");
            }
            break;
          case 3: //between
          console.log("evaluating: ",$("#"+set+"-start").val(),$("#"+set+"-end").val());
            if($("#"+set+"-start").val() == "0000"){
              $("#"+set+"-start").val("");
            }
            if($("#"+set+"-end").val() == "9999"){
              $("#"+set+"-end").val("");
            }
            break;
          default:
            break;

        }
                console.log("data");      }
   })

    var searchFormView = new SearchFormView();

    var personListView = new PersonListView();

    var PersonSingleView = Backbone.View.extend({
      el: '.page',
      events: {
        'submit .edit-user-form': 'saveUser',
        'click .delete': 'deleteUser'
      },
      saveUser: function (ev) {
        var userDetails = $(ev.currentTarget).serializeObject();
        var user = new User();
        user.save(userDetails, {
          success: function (user) {
            router.navigate('', {trigger:true});
          }
        });
        return false;
      },
      deleteUser: function (ev) {
        this.user.destroy({
          success: function () {
            console.log('destroyed');
            router.navigate('', {trigger:true});
          }
        })
      },
      render: function (options) {

  var person = new Person(importPeople[options.id-1])
              var template = _.template($('#view-person-template').html(), {person: person});
              this.$el.html(template);
              var template = _.template($('#breadcrumb-template').html(), {breadcrumbs: [{url: "#/view/"+person.id,
                title: person.get('forenames') + " " + person.get('surname')}]});
              $('#breadcrumb').html(template);
      }
    });

    var personSingleView = new PersonSingleView();

    var Router = Backbone.Router.extend({
        routes: {
          "" : "home", 
          "view/:id": "viewPerson",
          "new": "editPerson",
    "persons": "home",
    "search":"searchForm"
        }
    });

    var router = new Router;

    router.on('route:home', function() {
      // render user list
      personListView.render();
    });

    router.on('route:searchForm', function(){
      searchFormView.render();
    });

    router.on('route:viewPerson', function(id) {
      personSingleView.render({id: id});
    });

    Backbone.history.start();


}(jQuery)); 
  </script>

</body>
</body>
</html>